{% extends "base.html" %}

{% block title %}{{ 'Edit User' if user else 'Add User' }} - EcoFreonTrack{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ 'Edit User' if user else 'Add New User' }}</h1>

    <form method="POST" class="form-card">
        <div class="form-row">
            <div class="form-group">
                <label for="username">Username *</label>
                <input type="text" id="username" name="username" value="{{ user.username if user else '' }}" required>
            </div>

            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" value="{{ user.email if user else '' }}" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="full_name">Full Name *</label>
                <input type="text" id="full_name" name="full_name" value="{{ user.full_name if user else '' }}" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" id="phone" name="phone" value="{{ user.phone if user else '' }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="role">Role *</label>
                <select id="role" name="role" required>
                    <option value="technician" {{ 'selected' if user and user.role == 'technician' else '' }}>
                        Technician
                    </option>
                    <option value="compliance_manager" {{ 'selected' if user and user.role == 'compliance_manager' else '' }}>
                        Compliance Manager
                    </option>
                    <option value="admin" {{ 'selected' if user and user.role == 'admin' else '' }}>
                        Admin/Owner
                    </option>
                </select>
                <small class="help-text">
                    <strong>Technician:</strong> Add service logs, upload certificates<br>
                    <strong>Compliance Manager:</strong> View dashboards, approve logs, generate reports<br>
                    <strong>Admin:</strong> Full system access, manage users and sites
                </small>
            </div>

            <div class="form-group">
                <label for="technician_id">Link to Technician (Optional)</label>
                <select id="technician_id" name="technician_id">
                    <option value="">-- None --</option>
                    {% for tech in technicians %}
                    <option value="{{ tech.id }}" {{ 'selected' if user and user.technician_id == tech.id else '' }}>
                        {{ tech.name }} ({{ tech.certification_number }})
                    </option>
                    {% endfor %}
                </select>
                <small class="help-text">Link this user account to an existing technician record</small>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="password">Password {{ '*' if not user else '(leave blank to keep current)' }}</label>
                <input type="password" id="password" name="password" {{ 'required' if not user else '' }} minlength="6">
                <small class="help-text">Minimum 6 characters</small>
            </div>

            <div class="form-group">
                <label>&nbsp;</label>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" name="is_active" {{ 'checked' if not user or user.is_active else '' }}>
                        Account Active
                    </label>
                    <label>
                        <input type="checkbox" name="is_verified" {{ 'checked' if user and user.is_verified else '' }}>
                        Email Verified
                    </label>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {{ 'Update User' if user else 'Create User' }}
            </button>
            <a href="{{ url_for('user_list') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.form-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group select {
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #007bff;
}

.help-text {
    font-size: 12px;
    color: #666;
    margin-top: 0.25rem;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    font-weight: normal;
    margin: 0;
}

.checkbox-group input[type="checkbox"] {
    margin-right: 0.5rem;
    width: auto;
}

.form-actions {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    text-decoration: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #545b62;
}
</style>
{% endblock %}
